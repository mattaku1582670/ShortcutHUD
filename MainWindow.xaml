<Window x:Class="ShortcutHUD.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:models="clr-namespace:ShortcutHUD.Models"
        mc:Ignorable="d"
        Title="ShortcutHUD"
        Icon="/AppIcon.ico"
        Width="330"
        Height="58"
        Topmost="True"
        WindowStyle="None"
        ResizeMode="NoResize"
        AllowsTransparency="True"
        Background="Transparent"
        ShowInTaskbar="True"
        Loaded="Window_Loaded"
        Closing="Window_Closing"
        StateChanged="Window_StateChanged"
        PreviewKeyDown="Window_PreviewKeyDown">

    <Window.Resources>
        <SolidColorBrush x:Key="HudBaseBrush" Color="#F7F9FB"/>
        <SolidColorBrush x:Key="HudTextBrush" Color="#1E2428"/>
        <SolidColorBrush x:Key="HudAccentBrush" Color="#2E6EA4"/>
        <SolidColorBrush x:Key="HudPanelBrush" Color="#E6FFFFFF"/>
        <SolidColorBrush x:Key="HudHeaderBrush" Color="#EEF2F6"/>
        <SolidColorBrush x:Key="HudBorderBrush" Color="#1F1E2428"/>
        <SolidColorBrush x:Key="KeyCapsuleBrush" Color="#E6EBEF"/>
    </Window.Resources>

    <Grid Margin="8" Background="Transparent">
        <Border x:Name="HeaderBorder"
                CornerRadius="12"
                Padding="12,8"
                Background="{StaticResource HudHeaderBrush}"
                BorderBrush="{StaticResource HudBorderBrush}"
                BorderThickness="1"
                MouseEnter="HeaderBorder_MouseEnter"
                MouseLeave="HeaderBorder_MouseLeave"
                MouseLeftButtonDown="HeaderBorder_MouseLeftButtonDown">

                <Border.Effect>
                <DropShadowEffect BlurRadius="12"
                                  Opacity="0.08"
                                  ShadowDepth="2"
                                  Color="#000000"/>
            </Border.Effect>

            <Border.ContextMenu>
                <ContextMenu x:Name="HudContextMenu">
                    <MenuItem x:Name="PinToggleMenuItem"
                              Header="ピン留め: OFF"
                              Click="PinToggleMenuItem_Click"/>
                    <Separator/>
                    <MenuItem Header="ショートカット再読込"
                              Click="ReloadMenuItem_Click"/>
                    <MenuItem Header="終了"
                              Click="ExitMenuItem_Click"/>
                </ContextMenu>
            </Border.ContextMenu>

            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- <Border Grid.Column="0"
                        Width="26"
                        Height="26"
                        CornerRadius="8"
                        Background="#F4F7FA"
                        BorderBrush="{StaticResource HudBorderBrush}"
                        BorderThickness="1"
                        VerticalAlignment="Center">
                    <TextBlock Text="&#xE765;"
                               FontFamily="Segoe MDL2 Assets"
                               Foreground="{StaticResource HudTextBrush}"
                               FontSize="14"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"/>
                </Border> -->

                <TextBlock Grid.Column="1"
                           Margin="10,0,0,0"
                           VerticalAlignment="Center"
                           Foreground="{StaticResource HudTextBrush}"
                           FontSize="13"
                           FontWeight="SemiBold"
                           Text="Shortcut Key"/>

                <StackPanel Grid.Column="2"
                            Orientation="Horizontal"
                            VerticalAlignment="Center">
                    <TextBlock Text="&#xE7B3;"
                               FontFamily="Segoe MDL2 Assets"
                               Foreground="{StaticResource HudTextBrush}"
                               FontSize="14"
                               Margin="0,0,8,0"
                               VerticalAlignment="Center"/>
                    <Slider x:Name="HeaderOpacitySlider"
                            Width="100"
                            Minimum="20"
                            Maximum="100"
                            ValueChanged="HeaderOpacitySlider_ValueChanged"/>
                    <Button x:Name="MinimizeButton"
                            Width="24"
                            Height="22"
                            Margin="8,0,0,0"
                            Background="#E7EDF2"
                            BorderBrush="{StaticResource HudBorderBrush}"
                            BorderThickness="0"
                            Click="MinimizeButton_Click">
                        <TextBlock Text="&#xE921;"
                                   FontFamily="Segoe MDL2 Assets"
                                   Foreground="{StaticResource HudTextBrush}"
                                   FontSize="10"
                                   VerticalAlignment="Center"
                                   HorizontalAlignment="Center"/>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

                <!-- <Border VerticalAlignment="Bottom"
                HorizontalAlignment="Center"
                Margin="0,0,0,-10"
                Width="24"
                Height="14"
                CornerRadius="7"
                Background="#EEF2F6"
                BorderBrush="{StaticResource HudBorderBrush}"
                BorderThickness="1"
                IsHitTestVisible="False">
            <TextBlock Text="&#xE70D;"
                       FontFamily="Segoe MDL2 Assets"
                       Foreground="{StaticResource HudTextBrush}"
                       FontSize="10"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center"/>
        </Border> -->

        <Popup x:Name="CategoryPopup"
               Placement="Bottom"
               StaysOpen="True"
               AllowsTransparency="True"
               PopupAnimation="Fade">
            <Border x:Name="CategoryPopupBorder"
                    Width="200"
                    Background="{StaticResource HudPanelBrush}"
                    BorderBrush="{StaticResource HudBorderBrush}"
                    BorderThickness="1"
                    CornerRadius="14"
                    Padding="10"
                    Opacity="0.95"
                    MouseEnter="CategoryPopupBorder_MouseEnter"
                    MouseLeave="CategoryPopupBorder_MouseLeave">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="14"
                                      Opacity="0.1"
                                      ShadowDepth="2"
                                      Color="#000000"/>
                </Border.Effect>

                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0"
                               Margin="2,0,0,8"
                               Foreground="{StaticResource HudTextBrush}"
                               FontSize="12"
                               FontWeight="SemiBold"
                               Text="Categories"/>

                    <Border Grid.Row="1"
                            Background="#F7FAFC"
                            CornerRadius="10"
                            BorderBrush="{StaticResource HudBorderBrush}"
                            BorderThickness="1">
                        <Grid>
                            <ScrollViewer MaxHeight="430" VerticalScrollBarVisibility="Auto">
                                <ListBox x:Name="CategoryListBox"
                                         ItemsSource="{Binding DisplayCategories}"
                                         BorderThickness="0"
                                         Background="Transparent"
                                         HorizontalContentAlignment="Stretch"
                                         Padding="4">
                                    <ListBox.ItemContainerStyle>
                                        <Style TargetType="ListBoxItem">
                                            <Setter Property="Padding" Value="0"/>
                                            <Setter Property="Margin" Value="0,2,0,2"/>
                                            <EventSetter Event="MouseEnter" Handler="CategoryListBoxItem_MouseEnter"/>
                                            <EventSetter Event="MouseLeave" Handler="CategoryListBoxItem_MouseLeave"/>
                                        </Style>
                                    </ListBox.ItemContainerStyle>
                                    <ListBox.ItemTemplate>
                                        <DataTemplate DataType="{x:Type models:ShortcutCategoryView}">
                                            <Border Padding="8,6"
                                                    CornerRadius="8"
                                                    Background="#EAF0F4">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <TextBlock Grid.Column="0"
                                                               Text="&#xE8FD;"
                                                               FontFamily="Segoe MDL2 Assets"
                                                               Foreground="{StaticResource HudAccentBrush}"
                                                               FontSize="12"
                                                               VerticalAlignment="Center"/>
                                                    <TextBlock Grid.Column="1"
                                                               Margin="8,0,0,0"
                                                               Text="{Binding Name}"
                                                               Foreground="{StaticResource HudTextBrush}"
                                                               FontSize="12"
                                                               FontWeight="SemiBold"
                                                               TextTrimming="CharacterEllipsis"
                                                               VerticalAlignment="Center"/>
                                                    <TextBlock Grid.Column="2"
                                                               Margin="8,0,0,0"
                                                               Text="&#xE72A;"
                                                               FontFamily="Segoe MDL2 Assets"
                                                               Foreground="#992E6EA4"
                                                               FontSize="11"
                                                               VerticalAlignment="Center"/>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>
                            </ScrollViewer>

                            <TextBlock x:Name="NoCategoryTextBlock"
                               Text="カテゴリがありません"
                                       Foreground="#991E2428"
                                       Visibility="Collapsed"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"/>
                        </Grid>
                    </Border>

                    <TextBlock x:Name="InfoTextBlock"
                               Grid.Row="2"
                               Margin="2,8,0,0"
                               Foreground="#FFD89B5E"
                               Visibility="Collapsed"
                               TextWrapping="Wrap"/>
                </Grid>
            </Border>
        </Popup>

        <Popup x:Name="DetailPopup"
               Placement="Right"
               StaysOpen="True"
               AllowsTransparency="True"
               PopupAnimation="Fade">
            <Border x:Name="DetailPopupBorder"
                    Width="320"
                    Background="{StaticResource HudPanelBrush}"
                    BorderBrush="{StaticResource HudBorderBrush}"
                    BorderThickness="1"
                    CornerRadius="14"
                    Padding="10"
                    Opacity="0.95"
                    MouseEnter="DetailPopupBorder_MouseEnter"
                    MouseLeave="DetailPopupBorder_MouseLeave">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="14"
                                      Opacity="0.1"
                                      ShadowDepth="2"
                                      Color="#000000"/>
                </Border.Effect>

                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock x:Name="DetailHeaderTextBlock"
                               Grid.Row="0"
                               Margin="2,0,0,8"
                               Foreground="{StaticResource HudTextBrush}"
                               FontSize="13"
                               FontWeight="SemiBold"
                               Text="Shortcuts"/>

                    <Border Grid.Row="1"
                            Background="#F7FAFC"
                            CornerRadius="10"
                            BorderBrush="{StaticResource HudBorderBrush}"
                            BorderThickness="1">
                        <Grid>
                            <ScrollViewer MaxHeight="430" VerticalScrollBarVisibility="Auto">
                                <ItemsControl ItemsSource="{Binding CurrentCategoryItems}" Padding="8">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate DataType="{x:Type models:ShortcutItem}">
                                            <Border Margin="0,3,0,3"
                                                    Padding="8,7"
                                                    CornerRadius="8"
                                                    Background="#EDF2F6"
                                                    ToolTip="{Binding Note}">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="2.4*"/>
                                                        <ColumnDefinition Width="1.4*"/>
                                                    </Grid.ColumnDefinitions>

                                                    <TextBlock Grid.Column="0"
                                                               Text="{Binding Name}"
                                                               Foreground="{StaticResource HudTextBrush}"
                                                               FontSize="12"
                                                               VerticalAlignment="Center"
                                                               TextTrimming="CharacterEllipsis"
                                                               Margin="0,0,8,0"/>

                                                    <Grid Grid.Column="1"
                                                          Height="28"
                                                          HorizontalAlignment="Left">
                                                        <Border Background="{StaticResource KeyCapsuleBrush}"
                                                                BorderBrush="#2B1E2428"
                                                                BorderThickness="1"
                                                                CornerRadius="14"
                                                                Padding="10,0"/>
                                                        <!-- Inset shadow approximation for WPF -->
                                                        <Border Margin="1"
                                                                Background="#00FFFFFF"
                                                                BorderBrush="#0D000000"
                                                                BorderThickness="0,1,0,0"
                                                                CornerRadius="13"/>
                                                        <TextBlock Text="{Binding Keys}"
                                                                   Margin="10,0"
                                                                   Foreground="{StaticResource HudTextBrush}"
                                                                   FontWeight="Bold"
                                                                   FontSize="12"
                                                                   VerticalAlignment="Center"
                                                                   TextTrimming="CharacterEllipsis"/>
                                                    </Grid>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>

                            <TextBlock x:Name="NoDetailTextBlock"
                                       Text="ショートカットがありません"
                                       Foreground="#991E2428"
                                       Visibility="Collapsed"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"/>
                        </Grid>
                    </Border>
                </Grid>
            </Border>
        </Popup>
    </Grid>
</Window>
