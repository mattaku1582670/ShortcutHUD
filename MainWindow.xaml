<Window x:Class="ShortcutHUD.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:models="clr-namespace:ShortcutHUD.Models"
        mc:Ignorable="d"
        Title="ShortcutHUD"
        Width="340"
        Height="50"
        Topmost="True"
        WindowStyle="None"
        ResizeMode="NoResize"
        AllowsTransparency="True"
        Background="Transparent"
        ShowInTaskbar="True"
        Loaded="Window_Loaded"
        Closing="Window_Closing"
        StateChanged="Window_StateChanged"
        PreviewKeyDown="Window_PreviewKeyDown">

    <Grid Margin="6">
        <Border x:Name="HeaderBorder"
                CornerRadius="8"
                Padding="10,7"
                Background="#E6DDE6EC"
                BorderBrush="#FFB7C5D2"
                BorderThickness="1"
                MouseEnter="HeaderBorder_MouseEnter"
                MouseLeave="HeaderBorder_MouseLeave"
                MouseLeftButtonDown="HeaderBorder_MouseLeftButtonDown">

            <Border.ContextMenu>
                <ContextMenu x:Name="HudContextMenu"
                             Opened="HudContextMenu_Opened">
                    <MenuItem x:Name="PinToggleMenuItem"
                              Header="ピン留め: OFF"
                              Click="PinToggleMenuItem_Click"/>

                    <MenuItem Header="透明度">
                        <MenuItem StaysOpenOnClick="True">
                            <MenuItem.Header>
                                <StackPanel Orientation="Horizontal" Margin="4">
                                    <TextBlock Text="20%" VerticalAlignment="Center" Margin="0,0,6,0"/>
                                    <Slider x:Name="OpacityMenuSlider"
                                            Width="140"
                                            Minimum="20"
                                            Maximum="100"
                                            SmallChange="1"
                                            LargeChange="5"
                                            TickFrequency="5"
                                            IsSnapToTickEnabled="False"
                                            ValueChanged="OpacityMenuSlider_ValueChanged"/>
                                    <TextBlock Text="100%" VerticalAlignment="Center" Margin="6,0,0,0"/>
                                </StackPanel>
                            </MenuItem.Header>
                        </MenuItem>
                    </MenuItem>

                    <Separator/>
                    <MenuItem Header="ショートカット再読込"
                              Click="ReloadMenuItem_Click"/>
                    <MenuItem Header="終了"
                              Click="ExitMenuItem_Click"/>
                </ContextMenu>
            </Border.ContextMenu>

            <DockPanel LastChildFill="False">
                <TextBlock DockPanel.Dock="Left"
                           Text="Shortcut HUD"
                           VerticalAlignment="Center"
                           Foreground="#FF274050"
                           FontWeight="SemiBold"/>

                <StackPanel Orientation="Horizontal"
                            DockPanel.Dock="Right"
                            HorizontalAlignment="Right">
                    <Button x:Name="PinButton"
                            Width="26"
                            Height="26"
                            Margin="0,0,6,0"
                            Content="📍"
                            ToolTip="ピン留め ON/OFF"
                            Click="PinButton_Click"/>

                    <Button x:Name="MinimizeButton"
                            Width="26"
                            Height="26"
                            Content="_"
                            FontWeight="Bold"
                            ToolTip="最小化"
                            Click="MinimizeButton_Click"/>
                </StackPanel>
            </DockPanel>
        </Border>

        <Popup x:Name="CategoryPopup"
               Placement="Bottom"
               StaysOpen="True"
               AllowsTransparency="True"
               PopupAnimation="Fade">
            <Border x:Name="CategoryPopupBorder"
                    Width="210"
                    Background="#F2F8FB"
                    BorderBrush="#FFB7C5D2"
                    BorderThickness="1"
                    CornerRadius="10"
                    Padding="10"
                    Opacity="0.95"
                    MouseEnter="CategoryPopupBorder_MouseEnter"
                    MouseLeave="CategoryPopupBorder_MouseLeave">

                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0"
                               Text="カテゴリ"
                               Foreground="#FF1E3340"
                               FontWeight="SemiBold"
                               Margin="0,0,0,6"/>

                    <TextBlock x:Name="InfoTextBlock"
                               Grid.Row="1"
                               Margin="0,0,0,6"
                               Foreground="#FFB04D00"
                               Visibility="Collapsed"
                               TextWrapping="Wrap"/>

                    <Grid Grid.Row="2">
                        <ScrollViewer MaxHeight="380"
                                      VerticalScrollBarVisibility="Auto">
                            <ListBox x:Name="CategoryListBox"
                                     ItemsSource="{Binding DisplayCategories}"
                                     BorderThickness="0"
                                     Background="Transparent"
                                     HorizontalContentAlignment="Stretch">
                                <ListBox.ItemContainerStyle>
                                    <Style TargetType="ListBoxItem">
                                        <Setter Property="Padding" Value="0"/>
                                        <Setter Property="Margin" Value="0,1,0,1"/>
                                        <EventSetter Event="MouseEnter" Handler="CategoryListBoxItem_MouseEnter"/>
                                        <EventSetter Event="MouseLeave" Handler="CategoryListBoxItem_MouseLeave"/>
                                    </Style>
                                </ListBox.ItemContainerStyle>
                                <ListBox.ItemTemplate>
                                    <DataTemplate DataType="{x:Type models:ShortcutCategoryView}">
                                        <Border Padding="8,6"
                                                CornerRadius="6"
                                                Background="#00FFFFFF">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBlock Grid.Column="0"
                                                           Text="{Binding Name}"
                                                           Foreground="#FF1E3340"
                                                           TextTrimming="CharacterEllipsis"/>
                                                <TextBlock Grid.Column="1"
                                                           Text=">"
                                                           Foreground="#FF567080"
                                                           FontWeight="Bold"
                                                           Margin="8,0,0,0"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </ScrollViewer>

                        <TextBlock x:Name="NoCategoryTextBlock"
                                   Text="表示できるカテゴリがありません。"
                                   Foreground="#FF6A7D88"
                                   Visibility="Collapsed"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"/>
                    </Grid>

                    <TextBlock x:Name="StatusTextBlock"
                               Grid.Row="3"
                               Margin="0,6,0,0"
                               Foreground="#FF0C6E3A"
                               Visibility="Collapsed"/>
                </Grid>
            </Border>
        </Popup>

        <Popup x:Name="DetailPopup"
               Placement="Right"
               StaysOpen="True"
               AllowsTransparency="True"
               PopupAnimation="Fade">
            <Border x:Name="DetailPopupBorder"
                    Width="323"
                    Background="#F7FBFD"
                    BorderBrush="#FFB7C5D2"
                    BorderThickness="1"
                    CornerRadius="10"
                    Padding="10"
                    Opacity="0.95"
                    MouseEnter="DetailPopupBorder_MouseEnter"
                    MouseLeave="DetailPopupBorder_MouseLeave">

                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock x:Name="DetailHeaderTextBlock"
                               Grid.Row="0"
                               Foreground="#FF1E3340"
                               FontWeight="SemiBold"
                               Margin="0,0,0,6"/>

                    <Grid Grid.Row="1">
                        <ScrollViewer MaxHeight="380"
                                      VerticalScrollBarVisibility="Auto">
                            <ItemsControl ItemsSource="{Binding CurrentCategoryItems}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate DataType="{x:Type models:ShortcutItem}">
                                        <Border Margin="0,1,0,1"
                                                Padding="6,4"
                                                CornerRadius="4"
                                                Background="#00FFFFFF"
                                                ToolTip="{Binding Note}">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="2.4*"/>
                                                    <ColumnDefinition Width="1.4*"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBlock Grid.Column="0"
                                                           Text="{Binding Name}"
                                                           Foreground="#FF1E3340"
                                                           TextTrimming="CharacterEllipsis"
                                                           Margin="0,0,8,0"/>

                                                <TextBlock Grid.Column="1"
                                                           Text="{Binding Keys}"
                                                           FontWeight="SemiBold"
                                                           Foreground="#FF0F5E83"
                                                           TextTrimming="CharacterEllipsis"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>

                        <TextBlock x:Name="NoDetailTextBlock"
                                   Text="ショートカットがありません。"
                                   Foreground="#FF6A7D88"
                                   Visibility="Collapsed"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"/>
                    </Grid>
                </Grid>
            </Border>
        </Popup>
    </Grid>
</Window>


